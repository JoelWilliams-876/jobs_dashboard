# -*- coding: utf-8 -*-
"""jobs_dashboard.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14AT7Hey6q40BVj6aZ-XcH178wJgVubxn
"""

import requests
import pandas as pd
import plotly.express as px
from bs4 import BeautifulSoup
import streamlit as st

# Function to fetch U-3 and U-6 data from the cps_empsit_a12 table
def fetch_unemployment_data():
    url = "https://www.bls.gov/news.release/empsit.t15.htm"
    response = requests.get(url)
    soup = BeautifulSoup(response.content, 'html.parser')
    table = soup.find("table", {"id": "cps_empsit_a12"})

    if not table:
        st.error("Table cps_empsit_a12 not found.")
        return pd.DataFrame()

    # Extract rows for U-3 and U-6
    u3_row = table.find("tr", {"id": "cps_empsit_a12-4-0"})
    u6_row = table.find("tr", {"id": "cps_empsit_a12-7-0"})

    if not u3_row or not u6_row:
        st.error("Specified rows for U-3 or U-6 not found in the table.")
        return pd.DataFrame()

    # Extract columns 5 through 9 (July 2024 to Nov. 2024)
    def extract_row_data(row):
        cols = row.find_all("td")[4:9]  # Columns 5 through 9
        return [float(col.text.strip()) for col in cols]

    u3_data = extract_row_data(u3_row)
    u6_data = extract_row_data(u6_row)

    # Define the corresponding dates
    dates = ["July 2024", "Aug. 2024", "Sept. 2024", "Oct. 2024", "Nov. 2024"]

    # Create a DataFrame with dates and unemployment rates
    df = pd.DataFrame({
        "Date": dates,
        "U-3": u3_data,
        "U-6": u6_data
    })

    return df

# Main Streamlit app
st.title("BLS Unemployment Data")

# Fetch and display unemployment data
if 'unemployment_df' not in st.session_state:
    st.session_state.unemployment_df = fetch_unemployment_data()

if not st.session_state.unemployment_df.empty:
    unemployment_df = st.session_state.unemployment_df

    # Display the full DataFrame
    st.subheader("Unemployment Data Table (July 2024 to Nov. 2024)")
    st.dataframe(unemployment_df)

    # Select unemployment rate (U-3 or U-6)
    unemployment_type = st.radio("Select Unemployment Rate:", ["U-3", "U-6"])

    # Filter data for the selected unemployment rate
    selected_data = unemployment_df[["Date", unemployment_type]].rename(columns={unemployment_type: "Rate"})

    # Display the filtered DataFrame for the selected rate
    st.subheader(f"Selected Data for {unemployment_type}")
    st.dataframe(selected_data)

    # Plot the unemployment data
    fig_unemployment = px.line(
        selected_data,
        x="Date",
        y="Rate",
        title=f"{unemployment_type} Unemployment Rate (July 2024 to Nov. 2024)",
        labels={"Date": "Date", "Rate": f"{unemployment_type} Unemployment Rate (%)"},
        template="plotly_dark"
    )
    st.plotly_chart(fig_unemployment)
else:
    st.error("No unemployment data available.")